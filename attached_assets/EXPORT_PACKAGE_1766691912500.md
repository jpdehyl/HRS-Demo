# Lead Intel Export Package

All essential code for copy-paste to new Replit.

---

## Quick Start Checklist

Before copying files:
1. Create new Replit with Node.js template
2. Add these secrets in Replit Secrets tab:
   - `TWILIO_ACCOUNT_SID`
   - `TWILIO_AUTH_TOKEN`
   - `TWILIO_API_KEY_SID`
   - `TWILIO_API_KEY_SECRET`
   - `TWILIO_TWIML_APP_SID`
   - `TWILIO_PHONE_NUMBER`
   - `GOOGLE_CLIENT_ID`
   - `GOOGLE_CLIENT_SECRET`
   - `GOOGLE_REFRESH_TOKEN`
   - `GEMINI_API_KEY` (or use Replit AI integration)

---

## 1. DATABASE SCHEMA (shared/schema.ts)

Copy the FULL schema from: `shared/schema.ts`

**For Phase 1 (minimal demo), you only need these tables:**
- `managers`
- `sdrs`
- `leads`
- `liveCoachingSessions`
- `liveTranscripts`
- `liveCoachingTips`
- `researchPackets`
- `contactHistory`

**Skip these until Phase 6:**
- `users`
- `sessions`
- `accountSpecialists`

---

## 2. TWILIO VOICE (server/twilio/twilioVoice.ts)

This is the WORKING Twilio implementation. Copy the full file from: `server/twilio/twilioVoice.ts`

**Key patterns that WORK:**
- Token generation at `/api/twilio/token`
- Voice webhook at `/api/twilio/voice` (simple dial, recording, NO transcription element)
- Client-side session creation at `/api/twilio/create-session`
- Recording download at `/api/twilio/recording-status`

**DO NOT USE:**
```xml
<!-- This element requires paid Twilio add-on and breaks calls -->
<Transcription .../>
```

**Secrets needed:** TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_API_KEY_SID, TWILIO_API_KEY_SECRET, TWILIO_TWIML_APP_SID, TWILIO_PHONE_NUMBER

---

## 3. SOFTPHONE COMPONENT (client/src/components/softphone.tsx)

Copy the full file from: `client/src/components/softphone.tsx`

**Key features:**
- Twilio Device initialization with token fetch
- Call connect/disconnect handling
- Session creation via `/api/twilio/create-session`
- Mute/unmute controls
- Call duration tracking

**Package needed:** `@twilio/voice-sdk`

---

## 4. GOOGLE DRIVE CLIENT (server/google/driveClient.ts)

Copy the full file from: `server/google/driveClient.ts`

**Key functions:**
- `listFilesInInbox()` - List files in INBOX folder
- `downloadFile()` - Download audio files
- `moveFileToProcessed()` - Move after processing
- `getKnowledgebaseContent()` - Fetch coaching knowledge base
- `uploadFileToDrive()` - Upload recordings
- `getLeadScoringParameters()` - Fetch scoring params

**Secrets needed:** GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_REFRESH_TOKEN

**Config (update folder IDs for your Drive):**
```typescript
export const DRIVE_CONFIG = {
  INBOX_FOLDER_ID: "your-inbox-folder-id",
  PROCESSED_FOLDER_ID: "your-processed-folder-id",
  KNOWLEDGE_DOC_ID: "your-knowledge-doc-id",
  LEAD_SCORING_PARAMS_DOC_ID: "your-scoring-params-doc-id"
};
```

---

## 5. GOOGLE SHEETS CLIENT (server/google/sheetsClient.ts)

Copy the full file from: `server/google/sheetsClient.ts`

**Key functions:**
- `fetchLeadsFromSheet()` - Get rows from spreadsheet
- `parseLeadsFromSheet()` - Convert to Lead objects
- `importLeadsFromGoogleSheets()` - Full import flow

**Config:**
```typescript
export const SHEETS_CONFIG = {
  LEADS_SPREADSHEET_ID: "your-spreadsheet-id"
};
```

---

## 6. AI TRANSCRIPTION (server/ai/transcribe.ts)

Copy the full file from: `server/ai/transcribe.ts`

**Key function:**
- `transcribeAudio()` - Transcribe audio buffer with Gemini

**Secret needed:** GEMINI_API_KEY (or AI_INTEGRATIONS_GEMINI_API_KEY via Replit integration)

---

## 7. LEAD RESEARCH (server/ai/leadResearch.ts)

Copy the full file from: `server/ai/leadResearch.ts`

**Key functions:**
- `researchLead()` - Full AI research with web grounding
- `researchResultToPacket()` - Convert to database record
- `webEnrichContact()` - Web scraping for contact info
- `deepLinkedInResearch()` - LinkedIn profile research

**Additional files needed:**
- `server/ai/websiteScraper.ts`
- `server/ai/companyHardIntel.ts`
- `server/ai/serpApiClient.ts`

---

## 8. LANDING PAGE (client/src/pages/landing.tsx)

Copy the full file from: `client/src/pages/landing.tsx`

**Self-contained with:**
- Three.js particle system (GalaxyParticles component)
- MediaPipe hand gesture tracking
- Hawk Ridge branding
- Login button

**Packages needed:**
```json
"three": "^0.x",
"@react-three/fiber": "^8.x",
"@react-three/drei": "^9.x",
"@mediapipe/hands": "^0.x",
"@mediapipe/camera_utils": "^0.x"
```

**Logo asset:** `attached_assets/logo.svg`

---

## 9. CSS THEME (client/src/index.css)

Copy the full file from: `client/src/index.css`

**Contains:**
- Light/dark mode variables
- Hawk Ridge color scheme (blue: #2C88C9, orange: #F26419)
- Elevation utilities (hover-elevate, active-elevate-2)
- Tailwind base configuration

---

## 10. DESIGN GUIDELINES (design_guidelines.md)

Copy file: `design_guidelines.md`

---

## 11. PROJECT DOCS (replit.md)

Copy file: `replit.md`

---

## 12. BRAND ASSETS

Copy these files to `attached_assets/`:
- `logo.svg` - Main logo
- `favicon.webp` - Favicon
- `ogImage.jpg` - Social share image

---

## BUILD ORDER FOR NEW REPLIT

### Phase 1: Infrastructure
1. Create new Node.js Replit
2. Copy `shared/schema.ts` (minimal tables only)
3. Add PostgreSQL database via Replit
4. Run `npm run db:push`
5. Add secrets

### Phase 2: Twilio (TEST FIRST!)
1. Copy `server/twilio/twilioVoice.ts`
2. Copy `client/src/components/softphone.tsx`
3. Configure Twilio Console (Voice URL, API Key)
4. **TEST: Make a real call before adding more**

### Phase 3: Lead Intel
1. Copy AI research files
2. Copy Google Drive/Sheets clients
3. Build lead CRUD UI
4. **TEST: Import and research a lead**

### Phase 4: Recording Pipeline
1. Wire up recording download
2. Add transcription
3. **TEST: Make call, verify recording**

### Phase 5: UI Polish
1. Copy landing page
2. Copy CSS theme
3. Build dashboard

### Phase 6: Auth (LAST!)
1. Add auth tables to schema
2. Build login/signup
3. Add role protection
4. **TEST: Everything still works**

---

## KEY LESSONS

### What Broke in Current Build:
1. Auth middleware interfered with Twilio webhooks
2. `<Transcription>` TwiML element requires paid add-on
3. Complex dependencies between auth and API routes

### How to Avoid:
1. Build Twilio completely FIRST, verify calls work
2. Never use `<Transcription>` in TwiML
3. Add auth as isolated middleware LAST
4. Use feature flags during development
5. Test after EACH phase

### Working TwiML Pattern:
```typescript
const dial = twiml.dial({
  callerId: config.phoneNumber,
  answerOnBridge: true,
  record: "record-from-answer-dual",
  recordingStatusCallback: `${baseUrl}/api/twilio/recording-status`,
  recordingStatusCallbackMethod: "POST",
  recordingStatusCallbackEvent: ["completed"],
});

dial.number(to);
```

### Client-Side Session Fallback:
```typescript
// When call connects, create session from client as backup
conn.on("accept", async () => {
  const callSid = conn.parameters?.CallSid;
  if (callSid) {
    await fetch("/api/twilio/create-session", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        callSid,
        phoneNumber,
        leadId,
        sdrId,
      }),
    });
  }
});
```

---

## FILE SIZE SUMMARY

| File | Lines | Purpose |
|------|-------|---------|
| shared/schema.ts | ~543 | Database models |
| server/twilio/twilioVoice.ts | ~590 | Twilio voice integration |
| client/src/components/softphone.tsx | ~432 | Browser softphone UI |
| server/google/driveClient.ts | ~261 | Google Drive API |
| server/google/sheetsClient.ts | ~153 | Google Sheets import |
| server/ai/leadResearch.ts | ~527 | AI lead research |
| server/ai/transcribe.ts | ~72 | Audio transcription |
| client/src/pages/landing.tsx | ~551 | 3D landing page |
| client/src/index.css | ~289 | Tailwind theme |
